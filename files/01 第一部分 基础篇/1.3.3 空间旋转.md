### 空间旋转

**1.描述**

在空间坐标系下，如果我们假设物体是一个质点的话，便可以利用空间向量\[X, Y, Z\]来唯一确定这个点，如图：

![](/assets/空间旋转-质点坐标.jpg)

但事实上，我们需要描述的物体（例如我们的数码相机）并非一个质点，而是有着形体结构的刚体。这里为了方便起见，用一个空间球体代表，如图所示：

![](/assets/空间旋转-2.jpg)

这样一来，这个球体就不能看做是一个质点了，用向量\[X,Y, Z\]已经无法准确表达这个球体了，因为这个球体自身也是带有一个坐标系的，我们需要知道球体（物体）每一个部分的相对位置。通常情况下，这两个坐标系是不平行的，如图：

![](/assets/空间旋转-3.jpg)

在描述这样刚体的时候，如果我们仅仅知道它的空间坐标，并不能唯一的确定这个刚体的实时状态，因为我们并不知道它是如何摆放的，即她自身的坐标系与参考坐标系之间的夹角（或者说两者之间的映射关系）。

**2.定义**

如果我们对所描述的刚体本身建立一个坐标系，用来描述反映刚体自身各个部分的映射关系，并将其置放于与某一参考坐标系下（这里我们就选择世界坐标系，两个坐标系原点之间的距离便是位移），这两个坐标系之间的角度映射关系便是空间旋转。为了更好的理解，简单起见，我们刚体坐标系与世界坐标平行，是一种理想状态，对于任意的初始状态的刚体，经过一系列的空间变换，最终与世界坐标系平行，那么这个过程就是空间旋转，当然逆变换的过程也是。

事实上，你可以理解为两个坐标系之间的变换就是空间旋转。

**3.表达方式**

**3.1 旋转矩阵**

* 定义

如果黑色坐标代表原始坐标，红色坐标为旋转后的坐标，那么两者之间的关系，完全可以用一个3\*3的矩阵来表达，这个矩阵就是我们要的旋转矩阵。

![](/assets/空间旋转-公式-1.jpg)

* 构建形式

旋转矩阵是最显而易见的构建形式，并且通过旋转矩阵表达空间旋转的方式是唯一的：

![](/assets/旋转矩阵-1.jpg)

**3.2 欧拉角**

**3.2.1 定义**

如果旋转矩阵是表达空间旋转的最终表达形式，而实际上，空间旋转过程可以是物体绕其旋转轴经过多次旋转而得到的：

事实上，任意次的绕轴旋转，都最终可以分解三个独立的分量，即物体绕X-Y-Z轴的旋转\[Rx, Ry, Rz\]。

**3.2.2 构建形式**

* 旋转方向

定义绕旋转轴逆时针方向为正方向，顺时针方向为负方向，如图：

![](/assets/rotation-aixes-direction.jpg)

如果不好理解这个旋转的方向，我们将旋转过程分解成三个，如下图所示：

| ![](/assets/rotation-aixes-direction-x.jpg)绕X旋转，X轴朝外，正方向为Y--&gt;Z | ![](/assets/rotation-aixes-direction-y.jpg)绕Y轴旋转，Y轴朝外，正方向为Z--&gt;X | ![](/assets/rotation-aixes-direction-z.jpg)绕Z轴旋转，Z轴朝外，正方向为X--&gt;Y |
| :---: | :---: | :---: |


* **旋转基**

当我们明确了旋转方向的规定，现在我们就来看看，旋转到底发生了什么？或者说空间旋让坐标发生了什么样的改变，同理，我们这里还是选择一个分解后的旋转，简单起见，我们选择绕Z轴旋转，这样一来，整个过程是发生在XOY平面，如图：

![](/assets/rotation-base.png)

该点在两个坐标系下的坐标值，以及两者之间的转换关系如下：

![](/assets/rotation-base--formula.png)

同理，我们可以得到三个这个的旋转基，如下表所示：

| 绕X轴旋转 | 绕Y轴旋转 | 绕Z轴旋转 |
| :---: | :---: | :---: |
| ![](/assets/rotation-x.png) | ![](/assets/rotation-y.png) | ![](/assets/rotation-z.png) |
| Rx | Ry | Rz |

用欧拉角表示空间旋转时，有了上述3个旋转基量，每一个旋转矩阵都可以转换为上述三个基的组合，也正是由于这是三个旋转基的组合，因此具体的构建方式各不相同。

* **连动轴与固定轴**

| **连动轴** | **固定轴** |
| :--- | :--- |
|<br>**1.如图所示，黑色坐标系为初始坐标系**|<br>**1.如图所示，黑色坐标系为初始坐标系**<br>|
|<br>![](/assets/连动轴-初始坐标.png)<br>|<br>![](/assets/固定轴-初始坐标.png)<br>|
|<br>**2.该点的初始坐标坐标值相应的用黑色向量表示**<br>|<br>**2.该点的初始坐标坐标值相应的用黑色向量表示**<br>|
|<br>(x,y,z)<br>|<br>(x,y,z)<br>|
|<br>**1.物体绕Z轴（黑色坐标系下Z轴旋转）旋转变换为蓝色坐标系**<br>|<br>**1.物体绕Z轴（黑色坐标系下Z轴旋转）旋转变换为蓝色坐标系**<br>|
|<br>![](/assets/连动轴-旋转1-坐标.png)<br>|<br>![](/assets/固定轴-旋转1-坐标.png)<br>|
|<br>**2.该点在黑色坐标系与蓝色坐标系之间的转换关系**<br>|<br>**2.该点在黑色坐标系与蓝色坐标系之间的转换关系**<br>|
|<br>![](/assets/连动轴-旋转1-变换.png)<br>|<br>![](/assets/固定轴-旋转1-变换.png)<br>|
|<br>**3.该点在蓝色坐标系下的坐标**<br>|<br>**3.该点在蓝色坐标系下的坐标**<br>|
|<br>![](/assets/连动轴-旋转1-不变量.png)<br>|<br>![](/assets/固定轴-旋转1-不变量.png)<br>|
|<br>**4.该点在黑色坐标系下的坐标**<br>|<br>**4.该点在黑色坐标系下的坐标**<br>|
|<br>![](/assets/连动轴-旋转1-最终变换.png)<br>|<br>![](/assets/固定轴-旋转1-最终变换.png)<br>|
|<br>**1.物体绕X轴（注意这里是蓝色坐标系下的X轴，不是黑色坐标系下的X轴）旋转变换为红色坐标系**<br>|<br>**1.物体绕X轴（注意这里是黑色坐标系下的X轴，不是蓝色坐标系下的X轴）旋转变换为红色坐标系**<br>|
|<br>![](/assets/连动轴-旋转2-坐标.png)<br>|<br>![](/assets/固定轴-旋转2-坐标.png)<br>|
|<br>**2.该点在蓝色坐标系和红色坐标系之间的转换关系**<br>|<br>**2.该点在黑色坐标系和红色坐标系之间的转换关系**<br>|
|<br>![](/assets/连动轴-旋转2-变换.png)<br>|<br>![](/assets/固定轴-旋转2-变换.png)<br>|
|<br>**3.该点在红色坐标系下的坐标**<br>|<br>**3.该点在红色坐标系下的坐标**<br>|
|<br>![](/assets/连动轴-旋转2-不变量.png)<br>|<br>![](/assets/固定轴-旋转2-不变量.png)<br>|
|<br>**4.该点黑色坐标系下坐标**<br>|<br>**4.该点黑色坐标系下坐标**<br>|
|<br>![](/assets/连动轴-旋转2-最终坐标.png)<br>|<br>![](/assets/连动轴-旋转2-最终坐标.png)<br>|
|<br>**1.物体绕Y轴（注意这里是红色坐标系下的Y轴，不是黑色坐标系下的Y轴）旋转变换为绿色坐标系**<br>|<br>**1.物体绕Y轴（注意这里是黑色坐标系下的Y轴，不是红色坐标系下的Y轴）旋转变换为绿色坐标系**<br>|
|<br>![](/assets/连动轴-旋转3-坐标.png)<br>|<br>![](/assets/固定轴-旋转3-坐标.png)<br>|
|<br>**2.该点在红色坐标系和绿色坐标系之间的转换关系**<br>|<br>**2.该点在黑色坐标系和绿色坐标系之间的转换关系**<br>|
|<br>![](/assets/连动轴-旋转3-变换.png)<br>|<br>![](/assets/固定轴-旋转3-变换.png)<br>|
|<br>**3.该点在绿色坐标系下的坐标**<br>|<br>**3.该点在绿色坐标系下的坐标**<br>|
|<br>![](/assets/连动轴-旋转3-不变量.png)<br>|<br>![](/assets/固定轴-旋转3-不变量.png)<br>|
|<br>**4.该点在黑色坐标系下的坐标**<br>|<br>**4.该点在黑色坐标系下的坐标**<br>|
|<br>![](/assets/连动轴-旋转-坐标转换公式.png)|<br>![](/assets/固定轴-旋转3-最终坐标.png)<br>|

**\*\*\***
****
| 连动轴 | 固定轴 |
| :--- | :--- |
| 刚体绕自身的坐标轴进行旋转 | 刚体绕特定的坐标轴旋转 |
| 无论进行多少次旋转，旋转矩阵右乘累加 | 无论进行多少次旋转，旋转矩阵左乘累加 |

* **构建形式**

| X--&gt;Y--&gt;Z | ![](/assets/rotation-x.png) | ![](/assets/rotation-y.png) | ![](/assets/rotation-z.png) |
| :---: | :--- | :---: | :--- |
| **X--&gt;Z--&gt;Y                               ** | ![](/assets/rotation-x.png) | ![](/assets/rotation-z.png) | ![](/assets/rotation-y.png) |
| **Y--&gt;X--&gt;Z** | ![](/assets/rotation-y.png) | ![](/assets/rotation-x.png) | ![](/assets/rotation-z.png) |
| **Y--&gt;Z--&gt;X** | ![](/assets/rotation-y.png) | ![](/assets/rotation-z.png) | ![](/assets/rotation-x.png) |
| **Z--&gt;X--&gt;Y** | ![](/assets/rotation-z.png) | ![](/assets/rotation-x.png) | ![](/assets/rotation-y.png) |
| **Z--&gt;Y--&gt;X** | ![](/assets/rotation-z.png) | ![](/assets/rotation-y.png) | ![](/assets/rotation-x.png) |
| \*\*\* |  |  |  |

**3.3 旋转轴-旋转角度**

**3.3.1 定义**

如图所示：任意的空间旋转，都可以看做是物体绕某一空间向量进行的旋转，即无论物体经过了多少次空间旋转，其最终状态和初始状态之间，都可以看做是物体围绕着某一个空间旋转轴进行的旋转。

![](/assets/rotation-axis-angle.png)

**3.3.2 构建形式**

![](/assets/angle-axies2rotation.png)其中：

**c = cos\(angle\)**

**s = sin\(angle\)**

**\(x , y, z\) = normalize\(x, y, z\)**

**3.4 四元数**

**3.4.1 定义**

四元数是一种高阶复数，q = （x, y, z, w\)，其中x, y, z表示虚部，w表示实部。x, y, z代表空间旋转轴的向量，w是跟旋转角度相关的一个量（注意w并不等于旋转角度）。

**3.4.2 构建形式**

![](/assets/quat2rotation.png)

**4.小结**

|  | **旋转矩阵** |
| :--- | :---: |
| **欧拉角（-P, O, K\)** | ![](/assets/欧拉角转旋转矩阵.png) |
| **旋转轴-旋转角（Ax, Ay, Az, Angle\)                                           c = cos\(Angle\)                                                                              s = sin\(Angle\)                                                                              t = 1 - c                                                                                          Ax \* Ax + Ay \* Ay + Az \* Az = 1.0** | ![](/assets/旋转轴-角转旋转矩阵.png) |
| **四元数（Qx, Qy, Qz, Qw）** | ![](/assets/四元数转旋转矩阵.png) |

---

|  | **欧拉角（-P,O,K）** |
| :---: | :---: |
| **旋转矩阵** | ![](/assets/旋转矩阵转欧拉角.png) |
| **旋转轴-旋转角\(Ax, Ay, Az, Angle\)** |  |
| **四元数\(Qx, Qy, Qz, Qw）** |  |

---

|  | 旋转轴-旋转角（Ax, Ay, Az, Angle\) |
| :---: | :--- |
| **旋转矩阵** |  |
| **欧拉角\(-P, O, K\)** |  |
| **四元数\(Qx, Qy, Qz, Qw\)** |  |

---

---

|  | **四元数（Qx,Qy, Qz, Qw\)** |
| :---: | :--- |
| **旋转矩阵** |  |
| **欧拉角\(-P,  O, K\)** |  |
| **旋转轴-旋转角（Ax, Ay, Az, Angle\)** |  |

---

* 欧拉角选用国内转角系（-phi, omega, kappa\)， 即绕Y轴顺时针旋转phi，再绕X轴逆时针旋转omega，最后绕Z轴逆时针旋转kappa；
* 旋转轴-旋转角度（Ax, Ay, Az, Angle\)，其中Ax \* Ax + Ay \* Ay + Az \* Az  = 1.0; 在计算过程中，也有用（Axx, Ayy, Azz\)三个向量表述， 其中Axx = Ax / Angle;  Ayy = Ay / Angle;  Azz = Az / Angle; 



